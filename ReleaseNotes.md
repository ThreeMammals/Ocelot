## Upgrade to .NET 9 (TFM `net9.0`, version 24.0) aka [.NET 9](https://dotnet.microsoft.com/en-us/download/dotnet/9.0) release
> Milestone: [.NET 9](https://github.com/ThreeMammals/Ocelot/milestone/11)
> Codenamed: [.NET 9](https://devblogs.microsoft.com/dotnet/announcing-dotnet-9/)
> Read the Docs: [Ocelot 24.0](https://ocelot.readthedocs.io/en/{0}/) with [PDF](https://ocelot.readthedocs.io/_/downloads/en/{0}/pdf/)
> Target Framework Monikers: `net8.0`, `net9.0`

### :information_source: About
On November 12th, 2024, the [.NET team](https://devblogs.microsoft.com/dotnet/author/dotnet) announced the release of the [.NET 9](https://dotnet.microsoft.com/en-us/download/dotnet/9.0) framework:

* .NET Blog: [Announcing .NET 9](https://devblogs.microsoft.com/dotnet/announcing-dotnet-9/)

This major release upgrades [Ocelot](https://www.nuget.org/packages/Ocelot) package [TFMs](https://learn.microsoft.com/en-us/dotnet/standard/frameworks#latest-versions) to `net9.0` in addition to the current `net8.0`. Thus, the current Ocelot [supported frameworks](https://dotnet.microsoft.com/en-us/platform/support/policy/dotnet-core#lifecycle) are .NET 8 LTS and .NET 9 STS. According to the [.NET Support Policy](https://dotnet.microsoft.com/en-us/platform/support/policy), the Ocelot team has discontinued support of .NET 6 and .NET 7 by providing the version [23.4.3](https://github.com/ThreeMammals/Ocelot/releases/tag/23.4.3) which targets those .NET versions.

### :new: What's New?

- [DevOps](https://github.com/ThreeMammals/Ocelot/labels/DevOps): The CI/CD infrastructure was migrated from CircleCI to GitHub Actions by @raman-m.

  #### Official Notice to the Community Regarding CircleCI

  Ocelot's previous CI/CD provider, [CircleCI](https://circleci.com/), facilitated professional and seamless development, build processes, and delivery of Ocelot versions for seven years, starting in [March 2018](https://github.com/ThreeMammals/Ocelot/pull/283). But last year, in January 2025, after patching Ocelot with version [23.4.3](https://github.com/ThreeMammals/Ocelot/releases/tag/23.4.3), our team encountered legal issues related to [CircleCI](https://circleci.com/) Co's policies, leading to this CI/CD provider stopping the build process for the [Ocelot project](https://app.circleci.com/pipelines/github/ThreeMammals/Ocelot). This legal issue and technical incident were unforeseen on our part because Ocelot is _open-source software_ (OSS), and forcibly stopping the project's build process and blocking accounts appears to be an unfortunate breach of OSS principles. We strongly believe that any developer or user, from any country, should be able to use software providers that support the OSS movement by offering free or other cost-free plans and serving the accounts of these users, OSS teams, and OSS projects 24/7, 365 days a year. We consider this legal issue and the resulting technical incidents involving CircleCI to be a serious breach of OSS principles and an act of discrimination against Ocelot users, developers, and customers who rely on Ocelot OSS, ultimately causing delays to the current release. **As a team, we do not recommend using CircleCI for OSS projects**, as there is no guarantee that these projects will not face discrimination from this U.S. company.

  For all developers, team leads, architects, and managers of any OSS projects—at least on GitHub—we recommend utilizing the built-in GitHub Actions CI/CD infrastructure. Since its founding, GitHub has supported OSS projects. Today, GitHub provides 2,000 minutes of free CI/CD build time per month for OSS repositories (public repos). Also, we strongly believe that GitHub will never violate its OSS policies without a notice period, nor fail to inform owners and maintainers that certain policies must be met by Ocelot's owners. In addition, we want to acknowledge that we are monitoring U.S. government regulations. Unfortunately, we must state that some GitHub products are unavailable in certain countries, even if the project is OSS and GitHub claims these products are free for OSS. Since the Ocelot team does not utilize these non-critical products (we prefer to energize our brains rather than rely on AI-driven products), and since the Ocelot project is currently well-served by GitHub Co, the Ocelot team affirms that Ocelot will remain on GitHub as long as its OSS-friendly policies continue. As a team, we hope that GitHub will never enforce extra rules on our project or other OSS projects.
  Regardless, we remain on GitHub!

  #### Technical Information

  Starting from version [24.0](https://github.com/ThreeMammals/Ocelot/releases/tag/{0}), all pull requests, development commits, and releases will be built using [GitHub Actions](https://docs.github.com/en/actions) workflows. We currently have [three workflows](https://github.com/ThreeMammals/Ocelot/tree/main/.github/workflows): one for pull requests ([PR](https://github.com/ThreeMammals/Ocelot/blob/main/.github/workflows/pr.yml)), one for the `develop` branch ([Develop](https://github.com/ThreeMammals/Ocelot/blob/main/.github/workflows/develop.yml)), and one for the `main` branch ([Release](https://github.com/ThreeMammals/Ocelot/blob/main/.github/workflows/release.yml)).

  The [PR](https://github.com/ThreeMammals/Ocelot/blob/main/.github/workflows/pr.yml) workflow will track code coverage using [Coveralls](https://coveralls.io/). After opening a pull request or submitting a new commit to a pull request, [Coveralls](https://coveralls.io) will publish a short message with the current code coverage once the top commit is built. Considering that [Coveralls](https://coveralls.io) retains the entire history but does not fail the build if coverage falls below the threshold, all workflows have a built-in 80% threshold, applied internally within the `build-cake` job, particularly during the "Cake Build" step-action. If the code coverage of a newly opened pull request drops below the 80% threshold, the `build-cake` job will fail, logging an appropriate message in the "Cake Build" step. For your information, the current code coverage of the Ocelot project is around 85-86%. The coverage threshold is subject to change in upcoming releases. All Coveralls builds can be viewed by navigating to the [ThreeMammals/Ocelot](https://coveralls.io/github/ThreeMammals/Ocelot) project on Coveralls.io.

### :up: What's Updated?

- **[Core](https://github.com/ThreeMammals/Ocelot/labels/Core)**:
  The main [Ocelot](https://www.nuget.org/packages/Ocelot) package and all [extension](https://www.nuget.org/profiles/ThreeMammals) packages [reference](https://github.com/search?q=repo%3AThreeMammals%2FOcelot%20%3CTargetFrameworks%3E&type=code) `net8.0` and `net9.0` target framework monikers (TFMs). Refer to [TargetFrameworks](https://github.com/search?q=repo%3AThreeMammals%2FOcelot%20%3CTargetFrameworks%3E&type=code) to verify this. The `net6.0` and `net7.0` TFMs have been removed. If your project still relies on these outdated TFMs, please continue using version [23.4.3](https://github.com/ThreeMammals/Ocelot/releases/tag/23.4.3).

- **[Authentication](https://ocelot.readthedocs.io/en/{0}/features/authentication.html)**:
  Testing of [Identity Server Bearer Tokens](https://ocelot.readthedocs.io/en/{0}/features/authentication.html#identity-server-bearer-tokens) functionality was stopped due to [vulnerabilities](https://github.com/ThreeMammals/Ocelot/security/dependabot) reported by Dependabot, specifically the "[IdentityServer Open Redirect vulnerability](https://github.com/ThreeMammals/Ocelot/security/dependabot?q=is%3Aclosed+IdentityServer)" security issue. More technical details were provided in the [23.4.3](https://github.com/ThreeMammals/Ocelot/releases/tag/23.4.3) release notes, where we notified the community. Ultimately, issue #2218 was addressed via pull request #2274.
  >**Note**: In upcoming releases, we plan to utilize the [ASP.NET Core Identity](https://learn.microsoft.com/en-us/aspnet/core/security/authentication/identity) framework in our [acceptance testing](https://github.com/ThreeMammals/Ocelot/tree/main/test/Ocelot.AcceptanceTests) project to align with .NET industry standards. As a result, we intend to replace the [IdentityServer4](https://github.com/DuendeArchive/IdentityServer4) library with [ASP.NET Core Identity](https://learn.microsoft.com/en-us/aspnet/core/security/authentication/identity), which also supports Bearer tokens, also known as `JwtBearerHandler` from the [Microsoft.AspNetCore.Authentication.JwtBearer](https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.authentication.jwtbearer) namespace.

- **[Administration](https://ocelot.readthedocs.io/en/{0}/features/administration.html)**:
  The [Ocelot.Administration](https://www.nuget.org/packages/Ocelot.Administration) extension package has been renamed to [Ocelot.Administration.IdentityServer4](https://github.com/ThreeMammals/Ocelot.Administration.IdentityServer4) (it is scheduled for deprecation) to address all [IdentityServer4](https://github.com/DuendeArchive/IdentityServer4)-related [vulnerabilities](https://github.com/ThreeMammals/Ocelot/security/dependabot) (issue #2218). The [package's source code](https://github.com/ThreeMammals/Ocelot/tree/release/23.4/src/Ocelot.Administration) has been moved out of the Ocelot repository (pull request #2274) and transferred to the newly created [Ocelot.Administration.IdentityServer4](https://github.com/ThreeMammals/Ocelot.Administration.IdentityServer4) repository.
  >**Note**: Currently, the [Administration](https://ocelot.readthedocs.io/en/{0}/features/administration.html) feature is solely based on the [IdentityServer4 package](https://github.com/ThreeMammals/Ocelot/blob/release/23.4/src/Ocelot.Administration/Ocelot.Administration.csproj#L38), whose [repository](https://github.com/IdentityServer/IdentityServer4) was archived by its owner on July 31, 2024. The Ocelot team will deprecate the new [Ocelot.Administration.IdentityServer4](https://github.com/ThreeMammals/Ocelot.Administration.IdentityServer4) extension package after the current Ocelot release; however, the repository will not be archived, allowing for potential patches in the future.

- **[Kubernetes](https://ocelot.readthedocs.io/en/{0}/features/kubernetes.html)**:
  1. Answered question #2256 on "How to provide a host to the Kubernetes service discovery provider?"
    Unfortunately, in the [Kubernetes](https://ocelot.readthedocs.io/en/{0}/features/kubernetes.html) chapter, it was unclear to users how to define a K8s endpoint host in the [Configuration](https://ocelot.readthedocs.io/en/{0}/features/kubernetes.html#configuration) due to the implicit reuse of `KubeClient`, which is created from the pod account during [Install](https://ocelot.readthedocs.io/en/{0}/features/kubernetes.html#install)-ation. As a team, we decided to add the new [AddKubernetes(Action&lt;KubeClientOptions&gt;) method](https://ocelot.readthedocs.io/en/{0}/features/kubernetes.html#addkubernetes-action-kubeclientoptions-method), which handles different user scenarios. It is now possible to provide manually configured `KubeClientOptions` in C# during [Install](https://ocelot.readthedocs.io/en/{0}/features/kubernetes.html#install)-ation, but users can also reuse `ServiceDiscoveryProvider` options from the global [configuration](https://ocelot.readthedocs.io/en/{0}/features/kubernetes.html#configuration), including the `Host` option to construct the [kubernetes](https://ocelot.readthedocs.io/en/{0}/features/kubernetes.html) endpoint address. The new overloaded `AddKubernetes(Action<KubeClientOptions>)` method was implemented in pull request #2257.
  2. In the [Ocelot.Provider.Kubernetes](https://www.nuget.org/packages/Ocelot.Provider.Kubernetes/) extension package, the `KubeClient` dependency library version was upgraded to `3.0.x`, which requires .NET 8.0 and .NET 9.0 TFMs for the current Ocelot version [24.0](https://github.com/ThreeMammals/Ocelot/releases/tag/24.0.0). `KubeClient` v3 was internally reviewed and released specifically to meet Ocelot's needs for this release. Thanks to Adam Friedman (@tintoy) for his collaboration! This package upgrade was implemented in pull request #2266.

- **[Sample](https://github.com/ThreeMammals/Ocelot/labels/sample)**:
  The learning [Samples](https://github.com/ThreeMammals/Ocelot/tree/main/samples) projects were reviewed, rewritten, and refactored due to issue #1912. The community brought to our attention that the documentation and [samples](https://github.com/ThreeMammals/Ocelot/tree/main/samples) were outdated, as .NET 8 allows the `Program.cs` file to be minimized using the "[Top-level statements](https://learn.microsoft.com/en-us/dotnet/csharp/fundamentals/program-structure/top-level-statements)" feature. This was ultimately addressed in pull requests #2244 and #2258.

### :notebook: Documentation Summary
Due to the major version increase to v24, all documentation chapters were reviewed to improve readability, eliminate ambiguity, provide more useful tables and data schemas, update code snippets with the syntax of [Top-level statements](https://learn.microsoft.com/en-us/dotnet/csharp/fundamentals/program-structure/top-level-statements), and add handy samples, among other enhancements. The entire documentation is designed to be truly professional for senior developers while remaining easy to read for junior developers and newcomers who are starting to use the Ocelot gateway.

We believe that Ocelot students will ask fewer questions in 2025 :wink:
For students, we always recommend finding answers in [Q&A](https://github.com/ThreeMammals/Ocelot/discussions/categories/q-a) category first. Honestly, it is advised to read existing discussions before opening a new question in repo [discussions](https://github.com/ThreeMammals/Ocelot/discussions).
For true Ocelot patriots, we have added a [README link](https://github.com/ThreeMammals/Ocelot?tab=readme-ov-file#documentation) to the smart [Ocelot AI Guru](https://gurubase.io/g/ocelot) assistant, which is always ready to answer any of your questions. Feel free to explore and interact with it! :blush:
